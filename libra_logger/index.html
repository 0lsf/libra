<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `libra_logger` crate."><meta name="keywords" content="rust, rustlang, rust-lang, libra_logger"><title>libra_logger - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="../favicon.ico"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../libra_logger/index.html'><div class='logo-container'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate libra_logger</p><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all libra_logger's items</p></a><div class="block items"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'libra_logger', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/libra_logger/lib.rs.html#4-323' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>libra_logger</a></span></h1><div class='docblock'><p>This crates provides API for both structured and not structured(text) logging</p>
<h1 id="text-logging" class="section-header"><a href="#text-logging">Text logging</a></h1>
<p>Text logging is configured via RUST_LOG macro and have exactly same facade as rust log crate</p>
<h1 id="structured-logging" class="section-header"><a href="#structured-logging">Structured logging</a></h1>
<p>This crate contains two levels of API for structured logging</p>
<ol>
<li>StructuredLogEntry class and send_struct_log! macro for directly composing structured log</li>
<li>Bridge between traditional log! macro and structured logging API</li>
</ol>
<h2 id="configuration" class="section-header"><a href="#configuration">Configuration</a></h2>
<p>Structured logger has separate log levels, configured with <code>STRUCT_LOG_LEVEL</code>.
It is set to debug by default, but it only has effect if structured logger is initialized.</p>
<p>Structured logger can be initialized manually with one of <code>init_XXX_struct_log</code> functions.
Preferred way to initialize structured logging is by using <code>init_struct_log_from_env</code>.
In this case <code>STRUCT_LOG_FILE</code> environment variable is used to set file name for structured logs</p>
<h2 id="direct-api" class="section-header"><a href="#direct-api">Direct API</a></h2>
<pre><code class="language-pseudo">use std::collections::HashMap;
use serde_json::Value;

pub struct StructuredLogEntry {
    text: Option&lt;String&gt;,
    pattern: Option&lt;&amp;'static str&gt;,
    name: Option&lt;&amp;'static str&gt;,
    module: Option&lt;&amp;'static str&gt;,
    location: Option&lt;&amp;'static str&gt;,
    git_rev: Option&lt;&amp;'static str&gt;,
    data: HashMap&lt;&amp;'static str, Value&gt;,
}

impl StructuredLogEntry {
    pub fn new_unnamed() -&gt; Self { /* ... */ }
    pub fn new_named(name: &amp;'static str) -&gt; Self { /* ... */ }
    /* ..Bunch of builder style setters for chained initialization such as
        entry.data(a, b).data(x, y).. */
}

// Usage:
send_struct_log!(StructuredLogEntry::new_named(&quot;category&quot;, &quot;Committed&quot;)
   .data(&quot;block&quot;, &amp;block)
   .data(&quot;autor&quot;, &amp;author))
</code></pre>
<p>Arguments passed to .data will be serialized into json, and as such should implement Serialize.
Only static strings are allowed as field names.</p>
<p>send_struct_log! should be used to send structured log entry.
This macro populates metadata such as git_rev, location and module, and also skips evaluation of StructuredLogEntry entirely, if structured logging is disabled</p>
<h2 id="log-macro-bridge" class="section-header"><a href="#log-macro-bridge">Log macro bridge</a></h2>
<p>Crate owners are not required to rewrite their code right away to support new structured logging.
Importing logger crate will automatically emit structured logging on every log(debug!, info!, etc) macro invocation.</p>
<p>So</p>
<pre><code class="language-pseudo">info!(&quot;Committing {}&quot;, block);
// Will emit(in addition to regular text log) structured log such as
// {
//   pattern: &quot;Committing {}&quot;,
//   data: {
//     block: &quot;&lt;id&gt;&quot;
//   },
//   ...metadata...
// }
</code></pre>
<p>There are few caveats to automatic structured logging generation</p>
<ol>
<li>
<p>Argument values for structured logging will be serialized with Debug implementation(vs proper json serialization if send_struct_log! macro is used), regardless of what formatter is used for textual log. As a consequence, this means, that every log argument must implement Debug. In theory, this is extra limitation, but in practice currently in libra node crate and it's dependencies there was no single log argument that would not satisfy this criteria.</p>
</li>
<li>
<p>Field names will be automatically evaluated if expression is a single identifier, as in example above field block will get human readable name in json. However, if more complex expression is passed, structured log field name will be based on position of argument: &quot;_0&quot;, &quot;_1&quot;, etc:</p>
</li>
</ol>
<pre><code class="language-pseudo">info!(&quot;Committing {}&quot;, block.id());
//-&gt;
// {
//  data: {
//    &quot;_0&quot;: &quot;&lt;id&gt;&quot;
//  },
//  ...metadata...
// }
</code></pre>
<p>Another way to set proper name to json fields is to use named format arguments:</p>
<pre><code class="language-pseudo">info!(&quot;Committing {id}&quot;, id=block.id());
//-&gt;
// {
//  data: {
//    &quot;id&quot;: &quot;&lt;id&gt;&quot;
//  },
//  ...metadata...
// }
</code></pre>
<p>Structured log sink
Application must define implementation of StructLogSink interface in order to direct structured logs emitted by send_struct_log and other macros. This sink can be only initialized once, by calling set_struct_logger function.</p>
<p>Currently 3 implementations for StructLogSink exist:</p>
<ol>
<li><code>NopStructLog</code> ignores structured logs</li>
<li><code>PrintStructLog</code> immediately prints structured logs to stdout</li>
<li><code>FileStructLog</code> prints structured logs into provided file. Using this logger creates separate thread for writing files and structured logging itself is asynchronous in this case.</li>
</ol>
</div><h2 id='reexports' class='section-header'><a href="#reexports">Re-exports</a></h2>
<table><tr><td><code>pub use <a class="mod" href="https://docs.rs/log/0.4.8/log/index.html" title="mod log">log</a>;</code></td></tr></table><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="prelude/index.html" title='libra_logger::prelude mod'>prelude</a></td><td class='docblock-short'></td></tr></table><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table><tr class='module-item'><td><a class="macro" href="macro.crit.html" title='libra_logger::crit macro'>crit</a></td><td class='docblock-short'><p>Define crit macro that specify libra as the target</p>
</td></tr><tr class='module-item'><td><a class="macro" href="macro.debug.html" title='libra_logger::debug macro'>debug</a></td><td class='docblock-short'><p>Define debug macro that specify libra as the target</p>
</td></tr><tr class='module-item'><td><a class="macro" href="macro.error.html" title='libra_logger::error macro'>error</a></td><td class='docblock-short'><p>Define  macro that specify libra as the target</p>
</td></tr><tr class='module-item'><td><a class="macro" href="macro.format_index.html" title='libra_logger::format_index macro'>format_index</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.format_struct_arg.html" title='libra_logger::format_struct_arg macro'>format_struct_arg</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.format_struct_args.html" title='libra_logger::format_struct_args macro'>format_struct_args</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.format_struct_args_and_pattern.html" title='libra_logger::format_struct_args_and_pattern macro'>format_struct_args_and_pattern</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.git_rev.html" title='libra_logger::git_rev macro'>git_rev</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.info.html" title='libra_logger::info macro'>info</a></td><td class='docblock-short'><p>Define info macro that specify libra as the target</p>
</td></tr><tr class='module-item'><td><a class="macro" href="macro.location.html" title='libra_logger::location macro'>location</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.send_struct_log.html" title='libra_logger::send_struct_log macro'>send_struct_log</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.struct_log.html" title='libra_logger::struct_log macro'>struct_log</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.struct_log_enabled.html" title='libra_logger::struct_log_enabled macro'>struct_log_enabled</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="macro" href="macro.trace.html" title='libra_logger::trace macro'>trace</a></td><td class='docblock-short'><p>Define trace macro that specify libra as the target</p>
</td></tr><tr class='module-item'><td><a class="macro" href="macro.warn.html" title='libra_logger::warn macro'>warn</a></td><td class='docblock-short'><p>Define warn macro that specify libra as the target</p>
</td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.Logger.html" title='libra_logger::Logger struct'>Logger</a></td><td class='docblock-short'><p>Logging framework for Libra that encapsulates a minimal dependency logger with support for
environmental variable (RUST_LOG) and asynchronous logging.
Note: only a single logger can be instantiated at a time. Repeated instantiates of the loggers
will only adjust the global logging level but will not change the initial filter.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.LoggingField.html" title='libra_logger::LoggingField struct'>LoggingField</a></td><td class='docblock-short'><p>Field is similar to .data but restricts type of the value to a specific type.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.StructuredLogEntry.html" title='libra_logger::StructuredLogEntry struct'>StructuredLogEntry</a></td><td class='docblock-short'></td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.Level.html" title='libra_logger::Level enum'>Level</a></td><td class='docblock-short'><p>An enum representing the available verbosity levels of the logger.</p>
</td></tr></table><h2 id='constants' class='section-header'><a href="#constants">Constants</a></h2>
<table><tr class='module-item'><td><a class="constant" href="constant.CHANNEL_SIZE.html" title='libra_logger::CHANNEL_SIZE constant'>CHANNEL_SIZE</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.DEFAULT_TARGET.html" title='libra_logger::DEFAULT_TARGET constant'>DEFAULT_TARGET</a></td><td class='docblock-short'></td></tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table><tr class='module-item'><td><a class="trait" href="trait.StructLogSink.html" title='libra_logger::StructLogSink trait'>StructLogSink</a></td><td class='docblock-short'></td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.init_file_struct_log.html" title='libra_logger::init_file_struct_log fn'>init_file_struct_log</a></td><td class='docblock-short'><p>Initializes struct logger sink that writes to specified file.
Can only be called once</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.init_println_struct_log.html" title='libra_logger::init_println_struct_log fn'>init_println_struct_log</a></td><td class='docblock-short'><p>Initialize struct logger sink that prints all structured logs to stdout
Can only be called once</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.init_struct_log_from_env.html" title='libra_logger::init_struct_log_from_env fn'>init_struct_log_from_env</a></td><td class='docblock-short'><p>Initializes struct logger from STRUCT_LOG_FILE env var.
If STRUCT_LOG_FILE is set, STRUCT_LOG_UDP_ADDR will be ignored.
Can only be called once</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.set_struct_logger.html" title='libra_logger::set_struct_logger fn'>set_struct_logger</a></td><td class='docblock-short'><p>Sets structured logger</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.struct_logger_enabled.html" title='libra_logger::struct_logger_enabled fn'>struct_logger_enabled</a></td><td class='docblock-short'><p>Checks if structured logging is enabled for level</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.struct_logger_set.html" title='libra_logger::struct_logger_set fn'>struct_logger_set</a></td><td class='docblock-short'><p>Checks if structured logging is enabled</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "libra_logger";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>